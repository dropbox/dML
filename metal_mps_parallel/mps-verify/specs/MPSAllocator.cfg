\* TLC Configuration for MPSAllocator
\* Run with: tlc MPSAllocator.tla -config MPSAllocator.cfg
\*
\* This verifies the ABA double-check pattern used in 6 functions:
\*   - getSharedBufferPtr
\*   - recordEvents
\*   - waitForEvents
\*   - recordStream
\*   - setBufferShape
\*   - getBufferShape

\* Constants - small values for tractable model checking
\* NumThreads=2 and NumBuffers=3 for faster verification
CONSTANTS
    NumThreads = 2
    NumBuffers = 3

\* Initial state
INIT Init

\* Next state relation
NEXT Next

\* Disable deadlock check - after shutdown, allocator is dead (expected)
CHECK_DEADLOCK FALSE

\* Safety properties - MUST be invariants (should always hold)
INVARIANTS
    TypeOK
    Safety
    LockHierarchy

\* SCALABILITY PROPERTIES - NOT invariants, they document bottlenecks
\* These are EXPECTED TO BE VIOLATED by the current design.
\* To check them manually, run TLC with -invariant ParallelLockHolding
\* and observe the counterexample showing the limitation.
\*
\* ParallelLockHolding - shows only 1 thread can hold locks at a time
\* GlobalSerializerViolation - shows all ops serialize through m_mutex
\* ExcessiveLocking - shows getPtr requires 2 lock round-trips
\* DoubleMutexBottleneck - shows double-check pattern overhead

\* Liveness (optional - can be slow with larger state spaces)
\* PROPERTIES
\*     EventuallyComplete

\* State constraint to bound counters and make state space finite
CONSTRAINT StateConstraint
