[pytest]
# Voice Project Pytest Configuration
# Run with: pytest -v

# Test discovery - ONLY tests/ directory
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# CRITICAL: Exclude vendor/external directories from collection
norecursedirs =
    .git
    .venv
    .venv-tts
    venv
    venv-tts
    venv_old
    build
    models
    CosyVoice
    llama.cpp
    stream-tts-cpp/external
    stream-tts-cpp/models
    stream-tts-cpp/.venv
    __pycache__
    *.egg-info
    .pytest_cache

# Default options
# Use -n auto for parallel tests: pytest -n auto
# For single-threaded debugging: pytest -n 0
addopts =
    -v
    --tb=short
    --strict-markers

# Markers
markers =
    unit: Fast unit tests (<1s each) - run on every commit
    integration: Integration tests (<30s each) - run before push
    asyncio: Tests that require pytest-asyncio event loop support
    quality: Quality/LLM-as-judge tests - run nightly
    llm_judge: LLM-as-Judge audio quality tests (requires OpenAI API key)
    comparison: C++ vs Python head-to-head comparison tests
    stress: Stress tests (long-running, >5min) - run weekly
    slow: Tests that take >10s
    requires_models: Tests that require model files to be present
    requires_binary: Tests that require the C++ binary to be compiled
    multilingual: Multilingual TTS->STT round-trip tests (EN/JA/ZH)
    physical: Physical hardware tests (microphone, speakers, audio loopback)
    g2p: Grapheme-to-phoneme conversion tests
    cjk: Chinese-Japanese-Korean lexicon tests
    amplitude_bug: Audio amplitude consistency tests for fadeout bug detection
    benchmark: Performance benchmark tests

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

# Minimum pytest version
minversion = 7.0

# Console output
console_output_style = progress
