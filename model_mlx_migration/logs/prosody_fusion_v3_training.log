/opt/homebrew/lib/python3.14/site-packages/webrtcvad.py:1: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
============================================================
Prosody-Punctuation Fusion Training
============================================================
Prosody JSON: data/prosody/esd.json
Output dir: checkpoints/prosody_punct_fusion_v3
Epochs: 3
Batch size: 63
Learning rate: 0.0001
Focal loss: True (gamma=2.0)
Balanced batching: True
Class weights: ?=3.0, !=3.0
============================================================

Loading dataset...
Loading prosody data from: data/prosody/esd.json
Loaded 17500 samples
Valid samples: 17500
Class distribution: {0: 13650, 1: 0, 2: 1548, 3: 2302}
Skipped (no punct or missing audio): 0
Train: 15750, Val: 1750
Training distribution:
  PERIOD: 12267 (77.9%)
  COMMA: 0 (0.0%)
  QUESTION: 1382 (8.8%)
  EXCLAIM: 2101 (13.3%)

Creating model...
Parameters: 12,276

Starting training...
Balanced batching: 3 non-empty classes: ['PERIOD', 'QUESTION', 'EXCLAIM']
Balanced batching: 584 batches per epoch, 21 per class
Step    20 | Loss: 1.7961 | Acc: 0.333 | Boost: 0.0694 | LR: 2.01e-06 | Time: 0s
Step    40 | Loss: 1.7928 | Acc: 0.333 | Boost: 0.0722 | LR: 4.01e-06 | Time: 0s
Step    60 | Loss: 1.7879 | Acc: 0.333 | Boost: 0.0762 | LR: 6.01e-06 | Time: 0s
Step    80 | Loss: 1.7816 | Acc: 0.333 | Boost: 0.0801 | LR: 8.01e-06 | Time: 0s
Step   100 | Loss: 1.7744 | Acc: 0.333 | Boost: 0.0855 | LR: 1.00e-05 | Time: 1s
Step   120 | Loss: 1.7661 | Acc: 0.333 | Boost: 0.0926 | LR: 1.20e-05 | Time: 1s
Step   140 | Loss: 1.7567 | Acc: 0.333 | Boost: 0.1009 | LR: 1.40e-05 | Time: 1s
Step   160 | Loss: 1.7457 | Acc: 0.333 | Boost: 0.1101 | LR: 1.60e-05 | Time: 1s
Step   180 | Loss: 1.7335 | Acc: 0.333 | Boost: 0.1216 | LR: 1.80e-05 | Time: 1s
Step   200 | Loss: 1.7199 | Acc: 0.333 | Boost: 0.1477 | LR: 2.00e-05 | Time: 1s
Saved checkpoint: checkpoints/prosody_punct_fusion_v3/step_200.npz
Step   220 | Loss: 1.7048 | Acc: 0.333 | Boost: 0.1805 | LR: 2.20e-05 | Time: 1s
Step   240 | Loss: 1.6879 | Acc: 0.333 | Boost: 0.2242 | LR: 2.40e-05 | Time: 1s
Step   260 | Loss: 1.6689 | Acc: 0.333 | Boost: 0.2902 | LR: 2.60e-05 | Time: 1s
Step   280 | Loss: 1.6477 | Acc: 0.333 | Boost: 0.3553 | LR: 2.80e-05 | Time: 1s
Step   300 | Loss: 1.6254 | Acc: 0.333 | Boost: 0.4343 | LR: 3.00e-05 | Time: 2s
Step   320 | Loss: 1.6023 | Acc: 0.333 | Boost: 0.5313 | LR: 3.20e-05 | Time: 2s
Step   340 | Loss: 1.5793 | Acc: 0.334 | Boost: 0.6019 | LR: 3.40e-05 | Time: 3s
Step   360 | Loss: 1.5572 | Acc: 0.334 | Boost: 0.6616 | LR: 3.60e-05 | Time: 3s
Step   380 | Loss: 1.5360 | Acc: 0.333 | Boost: 0.7169 | LR: 3.80e-05 | Time: 3s
Step   400 | Loss: 1.5158 | Acc: 0.333 | Boost: 0.7606 | LR: 4.00e-05 | Time: 3s
Saved checkpoint: checkpoints/prosody_punct_fusion_v3/step_400.npz
Step   420 | Loss: 1.4966 | Acc: 0.331 | Boost: 0.7962 | LR: 4.20e-05 | Time: 3s
Step   440 | Loss: 1.4782 | Acc: 0.331 | Boost: 0.8392 | LR: 4.40e-05 | Time: 3s
Step   460 | Loss: 1.4609 | Acc: 0.332 | Boost: 0.8988 | LR: 4.60e-05 | Time: 4s
Step   480 | Loss: 1.4448 | Acc: 0.332 | Boost: 1.0120 | LR: 4.80e-05 | Time: 4s
Step   500 | Loss: 1.4295 | Acc: 0.331 | Boost: 1.0828 | LR: 5.00e-05 | Time: 4s
Step   520 | Loss: 1.4154 | Acc: 0.331 | Boost: 1.1344 | LR: 5.20e-05 | Time: 4s
Step   540 | Loss: 1.4020 | Acc: 0.331 | Boost: 1.1897 | LR: 5.40e-05 | Time: 4s
Step   560 | Loss: 1.3895 | Acc: 0.331 | Boost: 1.2674 | LR: 5.60e-05 | Time: 4s
Step   580 | Loss: 1.3778 | Acc: 0.331 | Boost: 1.2865 | LR: 5.80e-05 | Time: 4s

Epoch 1/3 complete (4s)
  Train Loss: 1.3755, Train Acc: 0.332
  Val Loss: 1.0831, Val Acc: 0.109
  Per-class recall: PERIOD=0.000 COMMA=0.000 QUESTION=0.572 EXCLAIM=0.473 
  New best! Saved to checkpoints/prosody_punct_fusion_v3/best.npz
Balanced batching: 3 non-empty classes: ['PERIOD', 'QUESTION', 'EXCLAIM']
Balanced batching: 584 batches per epoch, 21 per class
Step   600 | Loss: 1.0497 | Acc: 0.338 | Boost: 1.3460 | LR: 6.00e-05 | Time: 4s
Saved checkpoint: checkpoints/prosody_punct_fusion_v3/step_600.npz
Step   620 | Loss: 1.0489 | Acc: 0.347 | Boost: 1.3550 | LR: 6.20e-05 | Time: 4s
Step   640 | Loss: 1.0487 | Acc: 0.340 | Boost: 1.3958 | LR: 6.40e-05 | Time: 4s
Step   660 | Loss: 1.0497 | Acc: 0.333 | Boost: 1.3975 | LR: 6.60e-05 | Time: 4s
Step   680 | Loss: 1.0490 | Acc: 0.331 | Boost: 1.4087 | LR: 6.80e-05 | Time: 4s
Step   700 | Loss: 1.0490 | Acc: 0.331 | Boost: 1.4283 | LR: 7.00e-05 | Time: 4s
Step   720 | Loss: 1.0485 | Acc: 0.331 | Boost: 1.4467 | LR: 7.20e-05 | Time: 4s
Step   740 | Loss: 1.0481 | Acc: 0.333 | Boost: 1.4460 | LR: 7.40e-05 | Time: 5s
Step   760 | Loss: 1.0483 | Acc: 0.332 | Boost: 1.4164 | LR: 7.60e-05 | Time: 5s
Step   780 | Loss: 1.0483 | Acc: 0.332 | Boost: 1.4440 | LR: 7.80e-05 | Time: 5s
Step   800 | Loss: 1.0484 | Acc: 0.331 | Boost: 1.4617 | LR: 8.00e-05 | Time: 5s
Saved checkpoint: checkpoints/prosody_punct_fusion_v3/step_800.npz
Step   820 | Loss: 1.0483 | Acc: 0.331 | Boost: 1.4694 | LR: 8.20e-05 | Time: 5s
Step   840 | Loss: 1.0483 | Acc: 0.332 | Boost: 1.4331 | LR: 8.40e-05 | Time: 5s
Step   860 | Loss: 1.0483 | Acc: 0.333 | Boost: 1.4757 | LR: 8.60e-05 | Time: 5s
Step   880 | Loss: 1.0481 | Acc: 0.333 | Boost: 1.4469 | LR: 8.80e-05 | Time: 5s
Step   900 | Loss: 1.0482 | Acc: 0.332 | Boost: 1.4643 | LR: 9.00e-05 | Time: 5s
Step   920 | Loss: 1.0481 | Acc: 0.332 | Boost: 1.4553 | LR: 9.20e-05 | Time: 5s
Step   940 | Loss: 1.0482 | Acc: 0.331 | Boost: 1.4495 | LR: 9.40e-05 | Time: 5s
Step   960 | Loss: 1.0482 | Acc: 0.331 | Boost: 1.4244 | LR: 9.60e-05 | Time: 5s
Step   980 | Loss: 1.0481 | Acc: 0.331 | Boost: 1.4498 | LR: 9.80e-05 | Time: 5s
Step  1000 | Loss: 1.0480 | Acc: 0.332 | Boost: 1.4359 | LR: 0.00e+00 | Time: 6s
Saved checkpoint: checkpoints/prosody_punct_fusion_v3/step_1000.npz
Step  1020 | Loss: 1.0479 | Acc: 0.332 | Boost: 1.4645 | LR: 0.00e+00 | Time: 6s
Step  1040 | Loss: 1.0478 | Acc: 0.331 | Boost: 1.4585 | LR: 0.00e+00 | Time: 6s
Step  1060 | Loss: 1.0479 | Acc: 0.331 | Boost: 1.4532 | LR: 0.00e+00 | Time: 6s
Step  1080 | Loss: 1.0478 | Acc: 0.332 | Boost: 1.4373 | LR: 0.00e+00 | Time: 6s
Step  1100 | Loss: 1.0477 | Acc: 0.332 | Boost: 1.4321 | LR: 0.00e+00 | Time: 6s
Step  1120 | Loss: 1.0477 | Acc: 0.332 | Boost: 1.4163 | LR: 0.00e+00 | Time: 6s
Step  1140 | Loss: 1.0478 | Acc: 0.331 | Boost: 1.4034 | LR: 0.00e+00 | Time: 6s
Step  1160 | Loss: 1.0477 | Acc: 0.331 | Boost: 1.3925 | LR: 0.00e+00 | Time: 6s

Epoch 2/3 complete (2s)
  Train Loss: 1.0476, Train Acc: 0.331
  Val Loss: 1.0797, Val Acc: 0.101
  Per-class recall: PERIOD=0.000 COMMA=0.000 QUESTION=0.398 EXCLAIM=0.552 
Balanced batching: 3 non-empty classes: ['PERIOD', 'QUESTION', 'EXCLAIM']
Balanced batching: 584 batches per epoch, 21 per class
Step  1180 | Loss: 1.0462 | Acc: 0.328 | Boost: 1.4454 | LR: 0.00e+00 | Time: 6s
Step  1200 | Loss: 1.0467 | Acc: 0.339 | Boost: 1.4277 | LR: 0.00e+00 | Time: 6s
Saved checkpoint: checkpoints/prosody_punct_fusion_v3/step_1200.npz
Step  1220 | Loss: 1.0462 | Acc: 0.340 | Boost: 1.4378 | LR: 0.00e+00 | Time: 7s
Step  1240 | Loss: 1.0467 | Acc: 0.342 | Boost: 1.4357 | LR: 0.00e+00 | Time: 7s
Step  1260 | Loss: 1.0466 | Acc: 0.339 | Boost: 1.4590 | LR: 0.00e+00 | Time: 7s
Step  1280 | Loss: 1.0463 | Acc: 0.339 | Boost: 1.3989 | LR: 0.00e+00 | Time: 7s
Step  1300 | Loss: 1.0462 | Acc: 0.340 | Boost: 1.4318 | LR: 0.00e+00 | Time: 7s
Step  1320 | Loss: 1.0465 | Acc: 0.336 | Boost: 1.4618 | LR: 0.00e+00 | Time: 7s
Step  1340 | Loss: 1.0469 | Acc: 0.334 | Boost: 1.4298 | LR: 0.00e+00 | Time: 7s
Step  1360 | Loss: 1.0467 | Acc: 0.333 | Boost: 1.4272 | LR: 0.00e+00 | Time: 7s
Step  1380 | Loss: 1.0468 | Acc: 0.332 | Boost: 1.4254 | LR: 0.00e+00 | Time: 8s
Step  1400 | Loss: 1.0469 | Acc: 0.331 | Boost: 1.4124 | LR: 0.00e+00 | Time: 8s
Saved checkpoint: checkpoints/prosody_punct_fusion_v3/step_1400.npz
Step  1420 | Loss: 1.0467 | Acc: 0.331 | Boost: 1.4311 | LR: 0.00e+00 | Time: 8s
Step  1440 | Loss: 1.0466 | Acc: 0.333 | Boost: 1.3848 | LR: 0.00e+00 | Time: 8s
Step  1460 | Loss: 1.0466 | Acc: 0.334 | Boost: 1.4402 | LR: 0.00e+00 | Time: 8s
Step  1480 | Loss: 1.0466 | Acc: 0.334 | Boost: 1.4093 | LR: 0.00e+00 | Time: 8s
Step  1500 | Loss: 1.0466 | Acc: 0.333 | Boost: 1.4550 | LR: 0.00e+00 | Time: 9s
Step  1520 | Loss: 1.0465 | Acc: 0.333 | Boost: 1.4376 | LR: 0.00e+00 | Time: 9s
Step  1540 | Loss: 1.0464 | Acc: 0.334 | Boost: 1.4094 | LR: 0.00e+00 | Time: 9s
Step  1560 | Loss: 1.0464 | Acc: 0.333 | Boost: 1.4164 | LR: 0.00e+00 | Time: 9s
Step  1580 | Loss: 1.0462 | Acc: 0.334 | Boost: 1.4486 | LR: 0.00e+00 | Time: 9s
Step  1600 | Loss: 1.0463 | Acc: 0.333 | Boost: 1.4311 | LR: 0.00e+00 | Time: 9s
Saved checkpoint: checkpoints/prosody_punct_fusion_v3/step_1600.npz
Step  1620 | Loss: 1.0464 | Acc: 0.333 | Boost: 1.4319 | LR: 0.00e+00 | Time: 9s
Step  1640 | Loss: 1.0463 | Acc: 0.332 | Boost: 1.4211 | LR: 0.00e+00 | Time: 9s
Step  1660 | Loss: 1.0462 | Acc: 0.333 | Boost: 1.4322 | LR: 0.00e+00 | Time: 10s
Step  1680 | Loss: 1.0461 | Acc: 0.333 | Boost: 1.4201 | LR: 0.00e+00 | Time: 10s
Step  1700 | Loss: 1.0461 | Acc: 0.333 | Boost: 1.4246 | LR: 0.00e+00 | Time: 10s
Step  1720 | Loss: 1.0461 | Acc: 0.333 | Boost: 1.4148 | LR: 0.00e+00 | Time: 10s
Step  1740 | Loss: 1.0460 | Acc: 0.334 | Boost: 1.4360 | LR: 0.00e+00 | Time: 10s

Epoch 3/3 complete (4s)
  Train Loss: 1.0461, Train Acc: 0.334
  Val Loss: 1.0770, Val Acc: 0.111
  Per-class recall: PERIOD=0.000 COMMA=0.000 QUESTION=0.518 EXCLAIM=0.542 
  New best! Saved to checkpoints/prosody_punct_fusion_v3/best.npz

============================================================
Training complete!
Total time: 0.2 minutes
Best validation accuracy: 0.111
Checkpoints saved to: checkpoints/prosody_punct_fusion_v3
============================================================
